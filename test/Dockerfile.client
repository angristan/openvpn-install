# checkov:skip=CKV_DOCKER_2:Test container doesn't need healthcheck
# checkov:skip=CKV_DOCKER_3:OpenVPN client requires root for NET_ADMIN
# trivy:ignore:AVD-DS-0002 OpenVPN client requires root for NET_ADMIN
# trivy:ignore:AVD-DS-0026 Test container doesn't need healthcheck
FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive

# Install OpenVPN client and testing tools
RUN apt-get update && apt-get install -y --no-install-recommends \
    openvpn \
    iproute2 \
    iputils-ping \
    procps \
    && rm -rf /var/lib/apt/lists/*

# Create TUN device directory (device will be mounted at runtime)
RUN mkdir -p /dev/net

# Copy test scripts
COPY test/client-entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

WORKDIR /etc/openvpn

ENTRYPOINT ["/entrypoint.sh"]
